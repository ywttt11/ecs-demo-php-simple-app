import urllib, json, sys
import requests # 'pip install requests'
import boto3 # AWS SDK for Python (Boto3) 'pip install boto3'
def lambda_handler(event , context):
    print(event)
    sts_connection = boto3.client(
        'sts',
        aws_access_key_id='AKIAZXCULK2DHYHDYY4Y',
        aws_secret_access_key='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'
    )
    assumed_role_object = sts_connection.assume_role(
        RoleArn="arn:aws:iam::668044318342:role/temporarySession",
        RoleSessionName="SessionRole",
        DurationSeconds = 3600
    )
    
    url_credentials = {}
    url_credentials['sessionId'] = assumed_role_object.get('Credentials').get('AccessKeyId')
    url_credentials['sessionKey'] = assumed_role_object.get('Credentials').get('SecretAccessKey')
    url_credentials['sessionToken'] = assumed_role_object.get('Credentials').get('SessionToken')
    json_string_with_temp_credentials = json.dumps(url_credentials)
    
    request_parameters = "?Action=getSigninToken"
    request_parameters += "&SessionDuration=43200"
    if sys.version_info[0] < 3:
        def quote_plus_function(s):
            return urllib.quote_plus(s)
    else:
        def quote_plus_function(s):
            return urllib.parse.quote_plus(s)
    request_parameters += "&Session=" + quote_plus_function(json_string_with_temp_credentials)
    request_url = "https://signin.aws.amazon.com/federation" + request_parameters
    r = requests.get(request_url)
    signin_token = json.loads(r.text)
    request_parameters = "?Action=login"
    request_parameters += "&Issuer=Example.org"
    request_parameters += "&Destination=" + quote_plus_function("https://console.aws.amazon.com/")
    request_parameters += "&SigninToken=" + signin_token["SigninToken"]
    request_url = "https://signin.aws.amazon.com/federation" + request_parameters
    
    # Send final URL to stdout
    sessionUrlAndAKSK={}
    sessionUrlAndAKSK["AKSKToken"] = url_credentials
    sessionUrlAndAKSK["WebUrl"] = request_url
    return {
        'statusCode': 200,
        'body': json.dumps(sessionUrlAndAKSK)
    }
